### Step 4 - Views, pages, and Endpoints

First, let's make a way to create a ShortLink.

Since we're making an API, let's make it REST-style. If REST is one of those "I've heard it a bunch 
but only half know what it means" things for you, I highly recommend reading up on it.

In normal REST style, our endpoint for creating a ShortLink should be named after the entity we're 
creating. Versioning APIs is also a reasonable thing to do. So let's put our creation endpoint at 
`bit.ly/api/v1/shortlink`.

To create a new ShortLink, we'll send a POST request there. Our POST request will include one required 
argument: the destination where our ShortLink will point. It'll also optionally take a slug argument. 
If no slug is provided, we'll generate one. The response will contain the newly-created ShortLink, 
including its slug and destination.
```
$ curl --data '{"destination": "rommelrico.com"}' https://bit.ly/api/v1/shortlink
{
  "slug": "ae8uFt",
  "destination": "rommelrico.com"
}
```

In usual REST style, we should allow GET, PUT, PATCH, and DELETE requests as well to read, modify, and 
delete links. But since that's not a requirement yet, we'll just reject non-POST requests with an 
error 501 ("not implemented") for now.

So our endpoint might look something like this (pseudocode):
```
public Response shortlink(Request request) {
    if (request.method() != HttpMethod.POST) {
        return new Response(HttpStatus.ERROR501);  // 501 NOT IMPLEMENTED
    }

    String destination = request.getData().getDestination();
    String slug = request.getData().getSlug();

    // if the request did not include a slug, make a new one
    if (slug == null) {
        slug = generateRandomSlug();
    }

    DB.insertLink(slug, destination);

    String responseBody = String.format("{'slug':'%s'}", slug);

    return new Response(HttpStatus.OK200, responseBody);
}
```

Of course, we haven't defined exactly how generateRandomSlug() works. Considering it a bit, it quickly 
becomes clear this is a pretty tangled issue. We'll have to figure out:
1. What characters can we use in randomly generated slugs? More possible characters means more 
   possible random slugs without making our shortlinks longer. But what characters are allowed in URLs?
2. How do we ensure a randomly generated slug hasn't already been used? Or if there is such a collision, 
   how do we handle it?

So let's jot down these questions, put them aside, and come back to them after we're done sketching 
our general app structure.

Second, let's make a way to follow a ShortLink. That's the whole point, after all!

Our shortened URLs should be as short as possible. So as mentioned before, we'll give them this 
format: `bit.ly/$slug`.

Where `$slug` is the slug (either auto-generated by us or specified by the user). We could make it 
clearer that this is a redirect endpoint, by using a format like `bit.ly/r/$slug`, for example. But 
that adds 2 precious characters of length to our shortlink URLs!

One potential challenge here: if/when we build a web app for our service, we'll need some way of 
differentiating our own pages from shortlinks. For example, if we want an about page at bit.ly/about, 
our back-end will need to know "about" isn't just a shortlink slug. In fact, we might want to 
"reserve" or "block" shortlinks for pages we think we might need, so users don't grab URLs we might 
want for our own site. Alternately we could just say our pages have paths that're always prefixed with 
something, like /w/. For example, `bit.ly/w/about`.

The code for the redirection endpoint is pretty simple:
```
public Response redirect(Request request) {
    String destination = DB.getLinkDestination(request.getPath());
    return new Response(HttpStatus.FOUND302, destination);  // 302 REDIRECT
}
```
 